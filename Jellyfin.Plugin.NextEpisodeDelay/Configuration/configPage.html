<!DOCTYPE html>
<html lang="en">
<head>
    <title>Next Episode Delay</title>
</head>
<body>
<div class="page type-interior pluginConfigurationPage" data-require="emby-input,emby-button,emby-checkbox,emby-select" data-role="page" id="NextEpisodeDelayConfigPage">
    <div data-role="content">
        <div class="content-primary">
            <form id="NextEpisodeDelayConfigForm">
                <fieldset class="verticalSection-extrabottompadding">
                    <legend class="sectionTitle">Next Episode Delay Configuration</legend>
                    <p class="fieldDescription">Configure the default delay before automatically playing the next episode.</p>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input id="enabledByDefault" type="checkbox" is="emby-checkbox" />
                            <span>Enable by default</span>
                        </label>
                        <div class="fieldDescription">
                            Enable the next episode delay for all users by default
                        </div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="defaultDelaySeconds">
                            Default delay (seconds)
                        </label>
                        <input id="defaultDelaySeconds" type="number" is="emby-input" min="0" max="300" step="5" />
                        <div class="fieldDescription">
                            Number of seconds to wait before playing the next episode (0 to disable, max 300)
                        </div>
                    </div>

                    <div class="selectContainer">
                        <label class="selectLabel" for="delayPreset">Quick Presets</label>
                        <select is="emby-select" id="delayPreset" class="emby-select-withcolor emby-select">
                            <option value="0">Disabled (0s)</option>
                            <option value="10">10 seconds</option>
                            <option value="20">20 seconds</option>
                            <option value="30" selected>30 seconds (Recommended)</option>
                            <option value="45">45 seconds</option>
                            <option value="60">60 seconds</option>
                            <option value="90">90 seconds</option>
                            <option value="120">120 seconds</option>
                        </select>
                        <div class="fieldDescription">
                            Choose a preset to quickly set the delay duration
                        </div>
                    </div>
                </fieldset>

                <div>
                    <button is="emby-button" type="submit" class="raised button-submit block emby-button">
                        <span>Save</span>
                    </button>
                    <br />
                </div>
            </form>
        </div>
    </div>

    <script type="text/javascript">
        const pluginId = "a8b9c0d1-e2f3-4a5b-6c7d-8e9f0a1b2c3d";
        const page = document.querySelector('#NextEpisodeDelayConfigPage');
        const form = document.querySelector('#NextEpisodeDelayConfigForm');

        function loadConfig() {
            Dashboard.showLoadingMsg();
            ApiClient.getPluginConfiguration(pluginId).then(function (config) {
                document.querySelector('#enabledByDefault').checked = config.EnabledByDefault || false;
                document.querySelector('#defaultDelaySeconds').value = config.DefaultDelaySeconds || 30;

                Dashboard.hideLoadingMsg();
            }).catch(function(err) {
                console.error('Failed to load config:', err);
                Dashboard.hideLoadingMsg();
            });
        }

        function saveConfig(e) {
            e.preventDefault();
            Dashboard.showLoadingMsg();

            ApiClient.getPluginConfiguration(pluginId).then(function (config) {
                config.EnabledByDefault = document.querySelector('#enabledByDefault').checked;
                config.DefaultDelaySeconds = parseInt(document.querySelector('#defaultDelaySeconds').value) || 30;

                ApiClient.updatePluginConfiguration(pluginId, config).then(function (result) {
                    Dashboard.processPluginConfigurationUpdateResult(result);
                }).catch(function(err) {
                    console.error('Failed to save config:', err);
                    Dashboard.hideLoadingMsg();
                });
            });

            return false;
        }

        // Event listeners
        page.addEventListener('pageshow', loadConfig);
        form.addEventListener('submit', saveConfig);

        // Preset selector
        document.querySelector('#delayPreset').addEventListener('change', function (e) {
            document.querySelector('#defaultDelaySeconds').value = e.target.value;
        });
    </script>
</div>
</body>
</html>
